---
layout: post
title: 依赖注入
category: go探索发现
tags: [go]
---

## 依赖注入
依赖注入（Dependency Injection, DI）是一种设计模式，它可以减轻对象之间的耦合，提高代码的可测试性和可重用性。

看一下golang代码使用依赖注入的简单用法
```
package main

import (
	"fmt"
)

// LogTail 是处理日志记录功能的接口
type LogTail interface {
	Write(message string, file string) bool
}

// LocalFile 是一个实现 LogTail 接口的结构体
type LocalFile struct{}

func (lf *LocalFile) Write(message string, file string) bool {
	fmt.Printf("Message saved to local file %s with message: %s\n", file, message)
	return true
}

// Log 是依赖 LogTail 的记录日志结构体
type Log struct {
	logTail LogTail
}

func NewLog(lt LogTail) *Log {
	return &Log{logTail: lt}
}

func (l *Log) Record(message string, file string) bool {
	return l.logTail.Write(message, file)
}

func main() {
	localFile := &LocalFile{}
	log := NewLog(localFile)
	log.Record("Hello, Dependency Injection!", "test.log")
}
```
可以看到Log对象通过接口的方式与LocalFile对象实现了解耦。测试时很容易模式LogTail的实现。 

这里体现的核心思想是类应该依赖于抽象，而不是依赖于具体的东西。假设Log对象有多个依赖的其他对象，Log对象不应该关注创建这些依赖的对象，而是由外部的注入器来管理。

